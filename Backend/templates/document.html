<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>VP Catalog — Projekat i Plan</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f7f9fb; }
    .card { border-radius: .75rem; }
    pre { background:#0d1117; color:#dfe7ff; padding:1rem; border-radius:.5rem; overflow:auto; }
    code { font-size:.9rem; }
    .muted { color:#6c757d }
    .section-title { margin-top:1.25rem; margin-bottom:.5rem; font-weight:700; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="#">VP Catalog — Dokument</a>
    <div>
      <a class="btn btn-sm btn-outline-light" href="#plan">Plan</a>
      <a class="btn btn-sm btn-outline-light" href="#arhitektura">Arhitektura</a>
      <a class="btn btn-sm btn-outline-light" href="#rute">Rute</a>
    </div>
  </div>
</nav>

<main class="container py-4">
  <div class="row">
    <div class="col-lg-10 mx-auto">

      <div class="card p-4 mb-4">
        <h3>VP Catalog — Sažetak projekta</h3>
        <p class="muted">Automatizovani backend + frontend za izradu i upravljanje vizuelnim katalogom proizvoda. Podržava upload slika, ML obradu (detekcija, klasifikacija, embeddings), deduplikaciju i upravljanje proizvodima.</p>

        <h5 class="section-title" id="ciljevi">Glavni ciljevi</h5>
        <ul>
          <li>Omogućiti merchantu da otpremi slike + opiše proizvod (boje, veličine) u jednoj formi.</li>
          <li>Pozadinski pipeline: preprocess → object detection → crop → attribute classification → dedupe.</li>
          <li>Treniranje vlastitog detekcijskog modela (YOLOv8) i integration u worker.</li>
          <li>Frontend za pregled i potvrdu rezultata, export/integaciju sa webshopom.</li>
        </ul>
      </div>

      <div class="card p-4 mb-4">
        <h4 id="plan">Plan po nedeljama (pregled)</h4>
        <p class="muted">Tempo: ~2–3 h/dan. Period: 22. okt 2025 — 15. jan 2026 (moguć buffer).</p>

        <ol>
          <li><strong>Nedeljа 1</strong> — setup repo, FastAPI skeleton, docker-compose (opcionalno), DB modeli.</li>
          <li><strong>Nedeljа 2</strong> — auth, product CRUD, upload endpoint (MinIO / lokalno).</li>
          <li><strong>Nedeljа 3</strong> — Celery worker skeleton, enqueue, status polling.</li>
          <li><strong>Nedeljа 4</strong> — detection stub / OCR stub, detections tabela.</li>
          <li><strong>Nedeljа 5</strong> — dataset & labelovanje (Roboflow/CVAT), eksport COCO.</li>
          <li><strong>Nedeljа 6</strong> — trening YOLO (transfer learning), dobijanje weights.</li>
          <li><strong>Nedeljа 7</strong> — integracija modela u worker, evaluacija.</li>
          <li><strong>Nedeljа 8</strong> — atributi (boja, tip), CLIP embeddings, dedupe (pHash + vector).</li>
          <li><strong>Nedeljа 9</strong> — frontend merchant panel (pregled, approve/merge).</li>
          <li><strong>Nedeljа 10</strong> — POC generisanja varijacija boja (img2img) — opcionalno.</li>
          <li><strong>Nedeljа 11</strong> — testovi, integracija, CI (GitHub Actions).</li>
          <li><strong>Nedeljа 12</strong> — finalni polish, demo screencast i dokumentacija.</li>
        </ol>
      </div>

      <div class="card p-4 mb-4">
        <h4 id="arhitektura">Arhitektura (visoki nivo)</h4>
        <p class="muted">Komponente:</p>
        <ul>
          <li><strong>API (FastAPI)</strong> — prihvat upload-a, autentikacija, admin endpoints.</li>
          <li><strong>DB (Postgres + pgvector)</strong> — proizvodi, slike, detections, atributi, embeddings.</li>
          <li><strong>Object store (MinIO / S3)</strong> — originali + crop-ovi.</li>
          <li><strong>Broker & Cache (Redis)</strong> — Celery broker, rate-limits, caching.</li>
          <li><strong>Workers (Celery)</strong> — pipeline za obradu i inferencu.</li>
          <li><strong>Frontend (React/Vite)</strong> — merchant panel za pregled/approve.</li>
        </ul>

        <h6 class="mt-3">Tipični tok (upload → katalog)</h6>
        <ol>
          <li>Korisnik otpremi slike + prompt (name, colors, sizes, description).</li>
          <li>API sprema fajlove u object store i upisuje metapodatke u DB.</li>
          <li>API enqueues Celery job `process_product(product_id, prompt)`.</li>
          <li>Worker radi preprocess → detector → crop → atribut classifier → embeddings → dedupe → zapis u DB.</li>
          <li>Merchant pregledava i potvrđuje proizvod u frontend-u.</li>
        </ol>
      </div>

      <div class="card p-4 mb-4">
        <h4 id="rute">Ključne rute (primeri)</h4>

        <p class="muted">Primer FastAPI rute za prikaz upload forme:</p>
        <pre><code class="language-python">from fastapi import FastAPI, Request
from fastapi.templating import Jinja2Templates
from fastapi.responses import HTMLResponse

templates = Jinja2Templates(directory="templates")

@app.get("/upload", response_class=HTMLResponse)
async def upload_page(request: Request):
    return templates.TemplateResponse("upload.html", {"request": request})</code></pre>

        <p class="muted">Upload handler (primanje multipart sa fajlovima i poljima):</p>
        <pre><code class="language-python">from typing import List
from fastapi import UploadFile, File, Form

@app.post("/upload")
async def upload_product(
    product_name: str = Form(...),
    product_colors: str = Form(None),
    product_sizes: str = Form(None),
    product_description: str = Form(None),
    generated_prompt: str = Form(None),
    product_images: List[UploadFile] = File(...)
):
    # snimi fajlove, napravi DB zapise, enqueue job
    return {"status":"queued"}</code></pre>
      </div>

      <div class="card p-4 mb-4">
        <h4>DB - ključne tabele (skica)</h4>
        <pre><code class="language-sql">CREATE TABLE users (...);
CREATE TABLE products (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  title TEXT,
  description TEXT,
  canonical_sku TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE product_images (
  id UUID PRIMARY KEY,
  product_id UUID REFERENCES products(id),
  s3_path TEXT,
  width INT, height INT,
  phash BIGINT,
  embedding VECTOR(768),
  processed BOOLEAN DEFAULT FALSE
);

CREATE TABLE detections (
  id UUID PRIMARY KEY,
  image_id UUID REFERENCES product_images(id),
  bbox JSONB,
  label TEXT, confidence FLOAT, crop_s3 TEXT
);</code></pre>
      </div>

      <div class="card p-4 mb-4">
        <h4>Docker / Dev stack (preporuka)</h4>
        <ul>
          <li>FastAPI, PostgreSQL, Redis, MinIO, Celery worker, Flower (monitor)</li>
          <li>Local dev: docker-compose.yml sa service-ima</li>
        </ul>

        <h6 class="mt-2">Kratke komande</h6>
        <pre><code># start server (dev)
uvicorn main:app --reload

# ako koristiš docker-compose
docker compose up --build</code></pre>
      </div>

      <div class="card p-4 mb-4">
        <h4>Problemi i debug tips (često)</h4>
        <ul>
          <li><strong>No route exists for name "static"</strong> — proveri da li si uradio
            <code>app.mount("/static", StaticFiles(directory="static"), name="static")</code>
            i da li fajlovi postoje u <code>static/</code> folderu.</li>
          <li><strong>TemplateResponse needs request</strong> — uvek vraćaj:
            <code>templates.TemplateResponse("file.html", {"request": request, ...})</code>.</li>
          <li><strong>404 na link</strong> — href mora da poklapa sa rutom (uz prefix ako ga router ima).</li>
        </ul>

        <h6 class="mt-2">Kontakt (notes)</h6>
        <p class="muted">Ako želiš, mogu generisati starter repo (zip) koji uključuje: main.py, upload router, templates, static fajlove i docker-compose.</p>
      </div>

      <div class="text-end mb-5">
        <small class="muted">Generisano za tebe — spremno za čuvanje kao lokalni dokument.</small>
      </div>

    </div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
